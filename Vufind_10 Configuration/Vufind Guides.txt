################################################################################
--------------------------------------------------------------------------------
1. Tải Vufind
wget https://github.com/vufind-org/vufind/releases/download/v10.0/vufind_10.0.deb
sudo dpkg -i vufind_10.0.deb
sudo apt-get install -f
sudo chown -R www-data:www-data /usr/local/vufind/local/cache
sudo chown -R www-data:www-data /usr/local/vufind/local/config
sudo mkdir /usr/local/vufind/local/cache/cli
sudo chmod 777 /usr/local/vufind/local/cache/cli
--------------------------------------------------------------------------------

################################################################################
--------------------------------------------------------------------------------
2. Chuẩn bị MySQL
--------------------------------------------------------------------------------
  Nếu đã set up mysql ở dạng mysql_native_password rồi thì có thể pass qua bước này
  ------------------------------------------------------------------------------
  sudo /usr/bin/mysql_secure_installation
  Chọn yes liên tục để reset lại database và user test
--------------------------------------------------------------------------------

################################################################################
--------------------------------------------------------------------------------
3. Cấu hình và liên kết Vufind đến Apache2
# Kiểm tra cấu hình của http-vufind.conf vì apache của server >=2.3 và tham khảo link dưới đây để cấu hình cho phù hợp
# Thêm đoạn tại Vhost vào file http-vufind.conf trước khi thực hiện lệnh link giữa vufind và apache
https://biapps.arbeiterkammer.at/gitlab/open/aksearch/aksearch/-/blob/56938752f3afcb2727916f2cce4bae3fb3a67459/config/vufind/httpd-vufind.conf
--------------------------------------------------------------------------------
# Thêm đoạn tại Vhost vào file http-vufind.conf trước khi thực hiện lệnh link giữa vufind và apache
sudo nano /usr/local/vufind/local/httpd-vufind.conf
    ------------------------------------------
    <VirtualHost *:80>
        DocumentRoot /usr/local/vufind/public
        ServerName repository.hcmute.edu.vn
        ServerAlias www.yourdomain.edu
    </VirtualHost>
    ------------------------------------------
--------------------------------------------------------------------------------
# Vào mục [site] trong file config.ini đổi lại url đến địa chỉ ip
sudo nano /usr/local/vufind/config/vufind/config.ini
--------------------------------------------------------------------------------
# Liên kết file cấu hình vufind với apache2
sudo ln -s /usr/local/vufind/local/httpd-vufind.conf /etc/apache2/conf-enabled/vufind.conf
sudo /etc/init.d/apache2 reload
sudo systemctl restart apache2
--------------------------------------------------------------------------------
# Lệnh hiển thị danh sách các Virtual Host được cấu hình trong Apache, bao gồm tên miền, địa chỉ IP và cổng nghe.
sudo apachectl –S
--------------------------------------------------------------------------------
# Kiểm tra cấu hình cổng lắng nghe trên của Apache 
sudo nano /etc/apache2/ports.conf
--------------------------------------------------------------------------------
# Kiểm tra các cấu hình vhost đang chạy trên apache
sudo apachectl -S
--------------------------------------------------------------------------------
# Sau đó, khởi động lại Apache
sudo systemctl restart apache2
sudo netstat -tuln | grep :86
--------------------------------------------------------------------------------
# Kiểm tra tường lửa có chặn cổng
# Nếu tường lửa đang chặn cổng 86, mở cổng bằng lệnh sau (nếu ubuntu server sử dụng ufw)
sudo ufw allow 86
--------------------------------------------------------------------------------

################################################################################
--------------------------------------------------------------------------------
4. Setup biến môi trường
sudo sh -c 'echo export JAVA_HOME=\"/usr/lib/jvm/default-java\" > /etc/profile.d/vufind.sh'
sudo sh -c 'echo export VUFIND_HOME=\"/usr/local/vufind\"  >> /etc/profile.d/vufind.sh'
sudo sh -c 'echo export VUFIND_LOCAL_DIR=\"/usr/local/vufind/local\"  >> /etc/profile.d/vufind.sh'
source /etc/profile.d/vufind.sh
--------------------------------------------------------------------------------

################################################################################
--------------------------------------------------------------------------------
5. Cấu hình Solr
# Solr chỉ lắng nghe trên giao diện local: Theo mặc định, Solr thường chỉ lắng nghe các kết nối trên giao diện local (127.0.0.1). Thay đổi cấu hình Solr để lắng nghe trên tất cả các giao diện mạng. 
# Tìm file cấu hình của Solr và chỉnh sửa lại
sudo nano /usr/local/vufind/config/vufind/config.ini
--------------------------------------------------------------------------------
# Chỉnh sửa địa chỉ của jetty host
sudo nano /usr/local/vufind/solr/vendor/bin/solr.in.sh
--------------------------------------------------------------------------------
# Sửa lại đường dẫn solr trong để khi import hệ thống
# SolrMarc không thể kết nối đến Solr do URL được cấu hình trong tệp import.properties là localhost (127.0.0.1). Điều này gây lỗi kết nối vì Solr thực sự chạy trên địa chỉ IP 172.22.22.223
sudo nano /usr/local/vufind/local/import/import.properties
--------------------------------------------------------------------------------
# Khởi động solr bằng lệnh 
./solr.sh start
--------------------------------------------------------------------------------

################################################################################
--------------------------------------------------------------------------------
6. Sửa lỗi 
# Mở trang web chứa địa chỉ vufind .../vufind/Install/Home lên sau sau đó autofig từng cái 
--------------------------------------------------------------------------------
# Cấu hình database
- nhập password cho user vufind 
- xác nhận lại password của user vufind 
- nhập password của root
--------------------------------------------------------------------------------
# Cấu hình ILS
- Chọn NoILS
- Mở tệp NoILS
sudo nano /usr/local/vufind/local/config/vufind/NoILS.ini
Sửa chế độ từ ils-offline sang ils-none
--------------------------------------------------------------------------------
